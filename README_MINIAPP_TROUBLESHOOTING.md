# –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å Telegram Mini App

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–∞–π—Ç–∞

–°–∞–π—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É `https://sopostavitel.ru` —Å –≤–∞–ª–∏–¥–Ω—ã–º SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º.

### –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
curl -I https://sopostavitel.ru

# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
echo | openssl s_client -connect sopostavitel.ru:443 -servername sopostavitel.ru 2>/dev/null | openssl x509 -noout -subject -issuer -dates
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è Telegram Mini App

1. **HTTPS –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** - URL –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `https://`
2. **–í–∞–ª–∏–¥–Ω—ã–π SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç** - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–¥–∞–Ω –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º —Ü–µ–Ω—Ç—Ä–æ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Let's Encrypt –ø–æ–¥—Ö–æ–¥–∏—Ç)
3. **–ü—É–±–ª–∏—á–Ω–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** - —Å–∞–π—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
4. **HTTP 200** - —Å–∞–π—Ç –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–æ—Ç–∞

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
cd /root/sopostavitel
cat .env | grep WEB_APP_URL

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# WEB_APP_URL=https://sopostavitel.ru
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç–∞
pkill -f 'python bot.py'

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
cd /root/sopostavitel
source venv/bin/activate
nohup python bot.py > /var/log/sopostavitel_bot.log 2>&1 &
```

## –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –≤ `.env` (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `https://sopostavitel.ru`)
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ–≤–∞–ª–∏–¥–µ–Ω –∏–ª–∏ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π
- –°–∞–π—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- –ë–æ—Ç –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ `.env`: `WEB_APP_URL=https://sopostavitel.ru`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL: `curl -I https://sopostavitel.ru`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

### 2. –û—à–∏–±–∫–∞ "Network Error" –≤ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

**–ü—Ä–∏—á–∏–Ω—ã:**
- API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- CORS –æ—à–∏–±–∫–∏
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ API –∑–∞–ø—É—â–µ–Ω: `ps aux | grep uvicorn`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Nginx: `tail -f /var/log/nginx/error.log`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API: `curl http://localhost:8000/api/mappings`

### 3. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ–≤–∞–ª–∏–¥–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–æ–ª—É—á–∏—Ç–µ Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
certbot certonly --standalone -d sopostavitel.ru -d www.sopostavitel.ru

# –û–±–Ω–æ–≤–∏—Ç–µ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—É—Ç–∏:
# /etc/letsencrypt/live/sopostavitel.ru/fullchain.pem
# /etc/letsencrypt/live/sopostavitel.ru/privkey.pem
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
./check_and_fix_miniapp.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç —Ç–µ–∫—É—â–∏–π `WEB_APP_URL`
2. –û–±–Ω–æ–≤–∏—Ç –µ–≥–æ –Ω–∞ `https://sopostavitel.ru`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–∞–π—Ç–∞ –∏ SSL
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –±–æ—Ç–∞

## –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ Telegram

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/web`
4. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üåê –û—Ç–∫—Ä—ã—Ç—å –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
5. –ï—Å–ª–∏ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞: `tail -50 /var/log/sopostavitel_bot.log`

## –õ–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞
tail -f /var/log/sopostavitel_bot.log

# –õ–æ–≥–∏ API
tail -f /var/log/sopostavitel_api.log

# –õ–æ–≥–∏ Nginx
tail -f /var/log/nginx/error.log
tail -f /var/log/nginx/access.log
```

